trigger: none

parameters:
- name: Since
  type: string
  default: '<default to now() - 20 minutes>'

jobs:
- template: /eng/common/pipelines/templates/jobs/archetype-sdk-tests-generate.yml
  parameters:
    JobTemplatePath: /eng/pipelines/jobs/credscan_matrix.yml
    SparseCheckoutPaths: [ "eng" ]
    MatrixConfigs:
        - Name: Python_regression_envs
          Path: eng/basic_tag_matrix.json
          Selection: sparse
          GenerateVMJobs: true
    AdditionalParameters:
      TestTimeoutInMinutes: 60
    PreGenerationSteps:
      - pwsh: |
          $(Build.SourcesDirectory)/eng/scripts/generate-tag-matrix.ps1 -MatrixFile $(Build.SourcesDirectory)/eng/basic_tag_matrix.json -RepoWithTags $(Build.SourcesDirectory) -Since "${{ parameters.Since }}"
        displayName: Prepare the Matrix File


# - job: Generate_Work_List
#   displayName: Generate Tag List
#   pool:
#     name: azsdk-pool-mms-win-2022-general
#     image: azsdk-pool-mms-win-2022-1espt
#     os: windows

#   steps:
#     - checkout: none

    # - pwsh: |
    #     $branch = "$(Build.SourceBranch)" -replace '^refs/heads/', ''

    #     Write-Host $branch

    #     git clone --no-checkout --filter=tree:0 https://github.com/azure/azure-sdk-assets.git $(Build.SourcesDirectory)
    #     git sparse-checkout init --cone
    #     git sparse-checkout set eng
    #     git checkout $branch
    #   displayName: Get the repo
        # - pwsh: |
        #     $(Build.SourcesDirectory)/eng/scripts/generate-tag-matrix.ps1 -MatrixFile $(Build.SourcesDirectory)/eng/basic_tag_matrix.json -RepoWithTags $(Build.SourcesDirectory) -Since "${{ parameters.Since }}"
        #   displayName: Prepare the Matrix File

